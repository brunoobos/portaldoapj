<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Escala 24x96</title>
</head>
<body>
  <h1>Escala 24x96</h1>

  <div>
    <label for="selectMes">Mês:</label>
    <select id="selectMes"></select>
    <label for="selectAno">Ano:</label>
    <select id="selectAno"></select>
  </div>

  <div>
    <button id="btnAddEquipe">Adicionar Equipe</button>
    <button id="btnSalvar">Salvar</button>
    <button id="btnVisualizar">Visualizar</button>
    <button id="btnExcluir">Excluir</button>
    <button id="btnFeriados">Feriados</button>
    <button id="btnAfastamentos">Afastamentos</button>
    <button id="btnAddTarefa">Tarefa</button>
    <button id="btnGerarEscala">Gerar Escala</button>
  </div>

  <!-- ✅ Elemento onde as equipes são renderizadas -->
  <div id="equipes-container"></div>

  <div id="resultado"></div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, addDoc, setDoc, getDocs, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCMYqcUU-fOB5nQoU2lBVnJIU_xzsk3eC0",
      authDomain: "escala-18337.firebaseapp.com",
      projectId: "escala-18337",
      storageBucket: "escala-18337.firebasestorage.app",
      messagingSenderId: "623332895586",
      appId: "1:623332895586:web:7070007bc7accfea1fda3b",
      measurementId: "G-RLP96MKFRR"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let equipes = [];

    const meses = ["Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho",
                   "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"];

    function renderEquipes() {
      const container = document.getElementById("equipes-container");
      container.innerHTML = "";
      equipes.forEach((equipe, index) => {
        const div = document.createElement("div");
        div.innerHTML = `
          <h4>Equipe ${index + 1}</h4>
          <input placeholder="Nome" value="${equipe.nome}" onchange="editarEquipe(${index}, 'nome', this.value)" />
          <input type="date" value="${equipe.dataInicio}" onchange="editarEquipe(${index}, 'dataInicio', this.value)" />
          <input placeholder="Fixo" value="${equipe.fixo}" onchange="editarEquipe(${index}, 'fixo', this.value)" />
          <input placeholder="Rotativo 1" value="${equipe.rotativos[0]}" onchange="editarRotativo(${index}, 0, this.value)" />
          <input placeholder="Rotativo 2" value="${equipe.rotativos[1]}" onchange="editarRotativo(${index}, 1, this.value)" />
          <input placeholder="Rotativo 3" value="${equipe.rotativos[2]}" onchange="editarRotativo(${index}, 2, this.value)" />
        `;
        container.appendChild(div);
      });
    }

    window.editarEquipe = function (index, campo, valor) {
      equipes[index][campo] = valor;
    }

    window.editarRotativo = function (index, pos, valor) {
      equipes[index].rotativos[pos] = valor;
    }

    async function salvarEquipes() {
      const ref = collection(db, "equipes");
      const snapshot = await getDocs(ref);
      snapshot.forEach(docSnap => deleteDoc(doc(db, "equipes", docSnap.id))); // Limpa antes de salvar

      for (let i = 0; i < equipes.length; i++) {
        await addDoc(ref, equipes[i]);
      }
    }

    async function visualizarEquipes() {
      const ref = collection(db, "equipes");
      const snapshot = await getDocs(ref);
      equipes = [];
      snapshot.forEach(docSnap => equipes.push(docSnap.data()));
      renderEquipes();
    }

    async function excluirEquipe() {
      const ref = collection(db, "equipes");
      const snapshot = await getDocs(ref);
      snapshot.forEach(docSnap => deleteDoc(doc(db, "equipes", docSnap.id)));
      equipes = [];
      renderEquipes();
    }

    function gerarEscala() {
      document.getElementById("resultado").innerText = "Escala gerada!";
    }

    function preencherMesAno() {
      const selectMes = document.getElementById('selectMes');
      const selectAno = document.getElementById('selectAno');
      selectMes.innerHTML = '';
      meses.forEach((m, i) => selectMes.innerHTML += `<option value="${i}">${m}</option>`);
      let anoAtual = new Date().getFullYear();
      selectAno.innerHTML = '';
      for(let a=anoAtual-5; a <= anoAtual+5; a++){
        selectAno.innerHTML += `<option value="${a}">${a}</option>`;
      }
      selectMes.value = new Date().getMonth();
      selectAno.value = anoAtual;
    }

    document.getElementById('btnAddEquipe').onclick = () => {
      equipes.push({
        nome: '',
        dataInicio: '',
        fixo: '',
        rotativos: ['', '', '']
      });
      renderEquipes();
    };

    document.getElementById('btnSalvar').onclick = async () => {
      await salvarEquipes();
      alert('Equipes salvas com sucesso!');
    };

    document.getElementById('btnVisualizar').onclick = async () => {
      await visualizarEquipes();
    };

    document.getElementById('btnExcluir').onclick = async () => {
      await excluirEquipe();
    };

    document.getElementById('btnGerarEscala').onclick = () => {
      if (equipes.length === 0) return alert('Cadastre equipes antes de gerar escala.');
      gerarEscala();
    };

    window.onload = () => {
      preencherMesAno();
      visualizarEquipes(); // carrega dados automaticamente ao abrir
    };
  </script>
</body>
</html>


















