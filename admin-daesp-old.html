<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Escala 24x96 - Admin Completo</title>
<style>
  body { font-family: Arial, sans-serif; background: #f5f5f5; padding: 20px; }
  h1 { text-align: center; }
  .section { background: #fff; border-radius: 5px; padding: 15px; margin-bottom: 20px; box-shadow: 0 0 5px #ccc; }
  button { padding: 8px 15px; margin: 5px; cursor: pointer; border-radius: 4px; border: none; }
  button#btnAddEquipe { background: #28a745; color: white; }
  button#btnSalvar { background: #007bff; color: white; }
  button#btnVisualizar { background: #ffc107; }
  button#btnExcluir { background: #dc3545; color: white; }
  button#btnGerarEscala { background: #17a2b8; color: white; }
  button#btnAfastamentos { background: #6f42c1; color: white; }
  button#btnFeriados { background: #6c757d; color: white; }
  button#btnAddTarefa { background: #28a745; color: white; margin-bottom: 10px; }
  button#btnExcluirAfastamento { background:#dc3545; color:white; margin-left:5px; }
  .calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin-top: 20px; }
  .calendar-day { border: 1px solid #ccc; border-radius: 4px; padding: 5px; min-height: 90px; font-size: 12px; background: #fff; position: relative; }
  .calendar-day.feriado { background-color: #b0b0b0 !important; color: #fff; }
  .calendar-day.hoje { background-color: yellow !important; color: black; }
  .calendar-day .data-num { font-weight: bold; }
  .work { margin: 2px 0; padding: 2px 4px; border-radius: 3px; cursor: pointer; }
  .work.extra-name { background: #ff66b2; color: white; } /* cor rosa para nomes extras */
  .afastamento { margin: 2px 0; padding: 2px 4px; border-radius: 3px; font-size: 11px; color: #fff; }
  .ferias { background: #ffc107; color: #333; }
  .licenca { background: #dc3545; }
  .compensacao { background: #6f42c1; }

  .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; 
           background: rgba(0,0,0,0.5); justify-content: center; align-items: center; }
  .modal-content { background: #fff; padding: 20px; border-radius: 8px; width: 90%; max-width: 400px; position: relative; }
  .modal-content label { display: block; margin: 10px 0 4px; }
  .modal-content input, .modal-content select { width: 100%; padding: 6px; box-sizing: border-box; }
  .close { position: absolute; top: 10px; right: 15px; font-size: 20px; cursor: pointer; }
  
</style>
</head>
<script src="equipes.js"></script>
</body>
</html>

<body>

<h1>Administração da Escala 24x96</h1>

<div class="section" id="equipes-container"></div>

<button id="btnAddEquipe">Adicionar Equipe</button>
<button id="btnSalvar">Salvar Equipes</button>
<button id="btnVisualizar">Visualizar Equipes</button>
<button id="btnExcluir">Excluir Equipe</button>
<button id="btnAfastamentos">Cadastrar Afastamentos</button>
<button id="btnExcluirAfastamento">Excluir Afastamento</button>
<button id="btnFeriados">Cadastrar Feriados</button>
<button id="btnExcluirFeriado">Excluir Feriado</button>

<div class="section">
  <h2>Gerar Relatório da Escala</h2>
  <label for="selectEquipe">Equipe:</label>
  <select id="selectEquipe"><option value="-1">Todas as equipes</option></select><br/>
  <label for="selectMes">Mês:</label>
  <select id="selectMes"></select><br/>
  <label for="selectAno">Ano:</label>
  <select id="selectAno"></select><br/>
  <button id="btnGerarEscala">Gerar Escala Mensal</button>
</div>

<button id="btnAddTarefa">Adicionar Tarefa</button>

<div id="relatorio"></div>

<!-- Modal afastamento -->
<div id="modalAfastamento" class="modal">
  <div class="modal-content">
    <span class="close" onclick="fecharModal('modalAfastamento')">&times;</span>
    <h3>Cadastrar Afastamento</h3>
    <label>Equipe:</label>
    <select id="modalEquipe"></select>
    <label>Membro:</label>
    <select id="modalMembro">
      <option value="F">Fixo</option>
      <option value="R0">Rotativo 1</option>
      <option value="R1">Rotativo 2</option>
      <option value="R2">Rotativo 3</option>
    </select>
    <label>Tipo:</label>
    <select id="modalTipo">
      <option value="FERIAS">Férias</option>
      <option value="LICENCA">Licença</option>
      <option value="COMPENSACAO">Compensação</option>
    </select>
    <label>Data início:</label>
    <input type="date" id="modalInicio" />
    <label>Data fim:</label>
    <input type="date" id="modalFim" />
    <br /><br />
    <button onclick="salvarAfastamento()">Salvar</button>
  </div>
</div>

<!-- Modal feriado -->
<div id="modalFeriado" class="modal">
  <div class="modal-content">
    <span class="close" onclick="fecharModal('modalFeriado')">&times;</span>
    <h3>Cadastrar Feriado</h3>
    <label>Data do Feriado:</label>
    <input type="date" id="feriadoData" />
    <br /><br />
    <button onclick="salvarFeriado()">Salvar Feriado</button>
  </div>
</div>

<!-- Modal tarefa -->
<div id="modalTarefa" class="modal">
  <div class="modal-content">
    <span class="close" onclick="fecharModal('modalTarefa')">&times;</span>
    <h3>Adicionar Tarefa</h3>
    <label>Nome da Pessoa:</label>
    <input type="text" id="inputNomeTarefa" />
    <label>Data:</label>
    <input type="date" id="inputDataTarefa" />
    <label>Descrição:</label>
    <input type="text" id="inputDescricaoTarefa" />
    <br /><br />
    <button onclick="salvarNovaTarefa()">Salvar</button>
  </div>
</div>

<script type="module">
  import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCMYqcUU-fOB5nQoU2lBVnJIU_xzsk3eC0",
    authDomain: "escala-18337.firebaseapp.com",
    projectId: "escala-18337",
    storageBucket: "escala-18337.firebasestorage.app",
    messagingSenderId: "623332895586",
    appId: "1:623332895586:web:7070007bc7accfea1fda3b",
    measurementId: "G-RLP96MKFRR"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // Dados em memória
  let equipes = [];
  let afastamentos = [];
  let feriados = [];
  let observacoes = {};
  let tarefas = [];

  const meses = [
    'Janeiro','Fevereiro','Março','Abril','Maio','Junho',
    'Julho','Agosto','Setembro','Outubro','Novembro','Dezembro'
  ];

  // Salvar afastamento no Firebase
  window.salvarAfastamento = async function () {
    const equipe = document.getElementById('selectEquipeAfastamento').value;
    const inicio = document.getElementById('inputDataInicioAfastamento').value;
    const fim = document.getElementById('inputDataFimAfastamento').value;
    const motivo = document.getElementById('inputMotivoAfastamento').value.trim();

    if (!equipe || !inicio || !fim || !motivo) {
      alert('Preencha todos os campos do afastamento.');
      return;
    }

    try {
      await addDoc(collection(db, "afastamentos"), {
        equipe,
        inicio,
        fim,
        motivo
      });
      alert('Afastamento salvo com sucesso no Firebase!');
      fecharModal('modalAfastamento');
      // Opcional: atualizar afastamentos locais
    } catch (e) {
      console.error("Erro ao salvar afastamento:", e);
      alert('Erro ao salvar afastamento.');
    }
  };

  // Renderizar equipes
  function renderEquipes() {
    const container = document.getElementById('equipes-container');
    container.innerHTML = '';
    equipes.forEach((eq, i) => {
      eq.rotativos = eq.rotativos || ['', '', ''];
      container.innerHTML += `
        <div class="section">
          <h3>Equipe ${i + 1}</h3>
          <label>Nome:</label><input type="text" value="${eq.nome || ''}" onchange="equipes[${i}].nome=this.value" /><br/>
          <label>Data Início:</label><input type="date" value="${eq.dataInicio || ''}" onchange="equipes[${i}].dataInicio=this.value" /><br/>
          <label>Fixo:</label><input type="text" value="${eq.fixo || ''}" onchange="equipes[${i}].fixo=this.value" /><br/>
          ${eq.rotativos.map((r,j) => `<label>R${j+1}:</label><input type="text" value="${r || ''}" onchange="equipes[${i}].rotativos[${j}]=this.value" /><br/>`).join('')}
        </div>`;
    });
    atualizarSelectEquipe();
    atualizarModalEquipe();
  }

  function atualizarSelectEquipe() {
    const sel = document.getElementById('selectEquipe');
    sel.innerHTML = '<option value="-1">Todas as equipes</option>';
    equipes.forEach((eq, i) => sel.innerHTML += `<option value="${i}">${eq.nome || 'Equipe ' + (i + 1)}</option>`);
  }

  function atualizarModalEquipe() {
    const sel = document.getElementById('selectEquipeAfastamento');
    if (!sel) return;
    sel.innerHTML = '';
    equipes.forEach((eq, i) => sel.innerHTML += `<option value="${i}">${eq.nome || 'Equipe ' + (i + 1)}</option>`);
  }

  function visualizarEquipes() {
    alert(equipes.map((eq, i) => `Equipe ${i + 1}: ${eq.nome}, Fixo: ${eq.fixo}, Rotativos: ${eq.rotativos.join(', ')}`).join('\n\n'));
  }

  function excluirEquipe() {
    let idx = prompt('Digite o número da equipe para excluir (começando em 0):');
    idx = parseInt(idx);
    if (!isNaN(idx) && idx >= 0 && idx < equipes.length) {
      if (confirm(`Excluir equipe ${equipes[idx].nome}?`)) {
        equipes.splice(idx, 1);
        renderEquipes();
      }
    } else {
      alert('Índice inválido.');
    }
  }

  function abrirModal(id) {
    document.getElementById(id).style.display = 'flex';
  }
  function fecharModal(id) {
    document.getElementById(id).style.display = 'none';
  }

  // Funções para preencher selects mês e ano
  function preencherMesAno() {
    const selectMes = document.getElementById('selectMes');
    const selectAno = document.getElementById('selectAno');
    selectMes.innerHTML = '';
    meses.forEach((m, i) => selectMes.innerHTML += `<option value="${i}">${m}</option>`);
    let anoAtual = new Date().getFullYear();
    selectAno.innerHTML = '';
    for(let a=anoAtual-5; a <= anoAtual+5; a++){
      selectAno.innerHTML += `<option value="${a}">${a}</option>`;
    }
    selectMes.value = new Date().getMonth();
    selectAno.value = anoAtual;
  }

  // A função gerarEscala permanece igual (pode ajustar depois se quiser usar Firebase)

  // Eventos dos botões
  document.getElementById('btnAddEquipe').onclick = () => {
    equipes.push({
      nome: '',
      dataInicio: '',
      fixo: '',
      rotativos: ['', '', '']
    });
    renderEquipes();
  };

  document.getElementById('btnSalvar').onclick = () => {
    alert('Equipes salvas em memória (sem localStorage). Você pode implementar salvamento no Firebase.');
  };

  document.getElementById('btnVisualizar').onclick = () => {
    visualizarEquipes();
  };

  document.getElementById('btnExcluir').onclick = () => {
    excluirEquipe();
  };

  document.getElementById('btnAfastamentos').onclick = () => {
    if (equipes.length === 0) return alert('Cadastre equipes antes de cadastrar afastamentos.');
    abrirModal('modalAfastamento');
  };

  document.getElementById('btnFeriados').onclick = () => {
    alert('Cadastro de feriados ainda não implementado para Firebase.');
  };

  document.getElementById('btnGerarEscala').onclick = () => {
    if (equipes.length === 0) return alert('Cadastre equipes antes de gerar escala.');
    alert('Função gerarEscala ainda não conectada ao Firebase, use local em memória.');
  };

  document.getElementById('btnAddTarefa').onclick = () => {
    alert('Cadastro de tarefas ainda não implementado para Firebase.');
  };

  function iniciar() {
    preencherMesAno();
    renderEquipes();
    atualizarSelectEquipe();
  }

  window.onload = iniciar;

</script>

</body>
</html>
